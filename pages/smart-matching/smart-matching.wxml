<!--pages/smart-matching/smart-matching.wxml-->
<view class="chat-container">
  <!-- 消息列表 -->
  <scroll-view 
    class="chat-messages" 
    scroll-y 
    scroll-top="{{scrollTop}}"
    scroll-with-animation
    enable-back-to-top
  >
    <view class="message-list">
      <view 
        wx:for="{{messages}}" 
        wx:key="timestamp" 
        class="message {{item.role === 'user' ? 'user-message' : 'ai-message'}}"
      >
        <!-- 头像 -->
        <view class="message-avatar">
          <image 
            wx:if="{{item.role === 'user'}}" 
            src="{{avatarUrl}}" 
            mode="aspectFill" 
            class="avatar-img"
          />
          <image 
            wx:else
            src="https://files.homesee.xyz/api/files/download/IMG_20251208_160325.png"
            mode="aspectFill"
            class="avatar-img"
          />
        </view>

        <!-- 内容 -->
        <view class="message-content">
          <view class="message-bubble">
            <!-- AI消息：使用rich-text直接渲染HTML -->
            <rich-text 
              wx:if="{{item.role === 'assistant'}}" 
              nodes="{{item.htmlContent}}"
              class="rich-content"
            ></rich-text>
            <!-- 用户消息：纯文本 -->
            <text wx:else user-select>{{item.content}}</text>
          </view>
        </view>
      </view>

      <!-- 加载中 -->
      <view wx:if="{{loading}}" class="message ai-message">
        <view class="message-avatar">
          <image 
            src="https://files.homesee.xyz/api/files/download/IMG_20251208_160325.png"
            mode="aspectFill"
            class="avatar-img"
          />
        </view>
        <view class="message-content">
          <view class="message-bubble typing-indicator">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 输入区域 -->
  <view class="chat-input-area">
    <view class="input-wrapper">
      <input 
        class="chat-input" 
        value="{{userInput}}" 
        bindinput="handleInput" 
        bindconfirm="sendMessage"
        confirm-type="send"
        placeholder="请输入您的租房需求..."
      />
      <button 
        class="send-btn {{!userInput || loading ? 'disabled' : ''}}" 
        bindtap="sendMessage"
        disabled="{{!userInput || loading}}"
      >
        SEND
      </button>
    </view>
  </view>
</view>
